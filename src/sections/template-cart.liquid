<!-- sections/{{ section.id }}.liquid -->

{% assign display_notes = section.settings.notes %}
{% assign display_additional_checkout_buttons = section.settings.additional_checkout_buttons %}

<div class="container l">
  <h1>{{ 'cart.title' | t }}</h1>
  <div data-cart-popup-container></div>
</div>

{% raw %}
  <script data-cart-template type="text/x-handlebars-template">
    {{#if item_count}}
      <div class="s-hide">
        <div class="row l-table m-table">
          <div class="column l5 m5"><label>{% endraw %}{{ 'cart.product' | t }}{% raw %}</label></div>
          <div class="column l3 m2"><label>{% endraw %}{{ 'cart.price' | t }}{% raw %}</label></div>
          <div class="column l2 m3"><label>{% endraw %}{{ 'cart.quantity' | t }}{% raw %}</label></div>
          <div class="column l2 m2 l-right m-right"><label>{% endraw %}{{ 'cart.subtotal' | t }}{% raw %}</label></div>
        </div>
      </div>

      {{#each items}}
        <div class="row l-table m-table margin-bottom-2x">
          <div class="column l5 m5 s12 v-top">
            <div class="row l-table m-table">
              <div class="column l3 m5 s12 v-top">
                {{#if this.image}}
                  <a href="{{this.url}}" class="block">
                    <img src="{{this.image}}" alt="{{this.title}}" class="wide">
                  </a>
                {{/if}}
              </div>
              <div class="column l9 m7 s12">
                <p class="h4 no-margin">
                  <a href="{{this.url}}">
                    {{this.product.title}}
                  </a>
                </p>
                {{#if this.variant_title}}
                  <p class="no-margin">
                    <a href="{{this.url}}">{{this.variant_title}}</a>
                  </p>
                {{/if}}

                {{#size this.properties 0}}
                  <p class="no-margin">
                    {{#each this.properties}}
                      {{this}}
                    {{/each}}
                  </p>
                {{/size}}
              </div>
            </div>
          </div>

          <div class="column l3 m2 s12 v-top">
            <div class="s-hide">
              <p class="no-margin">{{formatMoney this.price}}</p>
            </div>
            <div class="m-hide l-hide">
              <p class="no-margin"><strong>{{formatMoney this.line_price}}</strong></p>
            </div>
          </div>

          <div class="column l2 m3 s6 v-top">
            <div class="quantity-adjust no-margin">
              <a href="#" class="adjust" data-item-quantity-minus="{{@index}}">&#8211;</a>
              <input class="quantity" type="number" name="updates[]" value="{{this.quantity}}" data-item-quantity-amount="{{@index}}" min="0" pattern="[0-9]*">
              <a href="#" class="adjust" data-item-quantity-plus="{{@index}}">&#43;</a>
            </div>
          </div>

          <div class="column l2 m2 s6 right v-top">
            <div class="s-hide margin-bottom-2x">
              {{#compare this.total_discount '>' 0}}
                <s>{{formatMoney this.original_line_price}}</s>
                <p class="no-margin">{{this.message}}</p>
              {% else %}
                <p class="no-margin"><strong>{{formatMoney this.line_price}}</strong></p>
              {{/compare}}
            </div>

            <a href="/cart/change?line={{@index}}&amp;quantity=0" class="button small" data-remove-item="{{@index}}">{% endraw %}{{ 'cart.remove' | t }}{% raw %}</a>
          </div>
        </div>
      {{/each}}
    {{else}}
      <p>{% endraw %}{{ 'cart.empty' | t }}{% raw %}</p>
    {{/if}}

    <div class="row">
      <div class="column l6 m6 s12">
        {% endraw %}
          {% if display_notes %}
            <label for="CartSpecialInstructions">{{ 'cart.notes' | t }}</label>
            <textarea class="wide" name="note" id="CartSpecialInstructions">{{ cart.note }}</textarea>
          {% endif %}
        {% raw %}
      </div>

      <div class="column l6 m6 s12 l-right m-right">
        <p>
          <span class="cart-total-heading">{% endraw %}{{ 'cart.total' | t }}{% raw %}</span>
          <span class="h3">{{this.total_price}}</span>
        </p>

        {{#compare cart.total_discount '>' 0}}
          <h3><s>{{{formatMoney this.original_total_price}}}</s></h3>
          <p>{% endraw %}{{ 'cart.savings' | t }}{% raw %} <span><i>{{{formatMoney cart.total_discounts}}}</i></span></p>
        {{/compare}}

        <p><i>{% endraw %}{{ 'cart.shipping_at_checkout' | t }}{% raw %}</i></p>
        <a href="/checkout" class="button{{#unless item_count}} disabled{{/unless}}" aria-label="{% endraw %}{{ 'cart.checkout' | t }}{% raw %}">{% endraw %}{{ 'cart.checkout' | t }}{% raw %}</a>

        {% endraw %}
          {% if additional_checkout_buttons and display_additional_checkout_buttons %}
            <div class="additional-checkout-buttons">
              {{ content_for_additional_checkout_buttons }}
            </div>
          {% endif %}
        {% raw %}
      </div>
    </div>
  </script>
{% endraw %}

<script type="text/javascript">
  // Cart page rendering
  $(document).on('cartfox:loaded cartfox:onRender', function(event, cart) {
    const source = $('[data-cart-template]').html();
    const template = Handlebars.compile(source);
    const html = template(cart);
    $('[data-cart-container]').html(html);
  });
</script>

{% schema %}
  {
    "name": "Cart template",
    "settings": [
      {
        "type": "header",
        "content": "Cart template"
      },
      {
        "type": "checkbox",
        "id": "notes",
        "label": "Display cart notes",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "additional_checkout_buttons",
        "label": "Display additional checkout buttons",
        "default": true
      }
    ]
  }
{% endschema %}
