{% comment %}
    This module reates a style tag containing "background-image" properties to
    load the correct image depending on the resolution

    Dependencies:
    - Lazysizes plugin (https://github.com/aFarkas/lazysizes)
      enables responsive image with faster load time and better performance.

    Accepts:
    - image: {Object} Image object
    - ratio: decimal value, e.g. 1.0 = 1:1, 0.5 = 2:1

    Usage:
    {% include 'responsive-bg-image' with
      image: image,
      ratio: 1.0
    %}
{% endcomment %}

{%- capture responsive_image_counter %}{% increment responsive_image_counter %}{% endcapture -%}

<style>
  .image-{{ responsive_image_counter }}.responsive-bg-image {
    padding-bottom: {{ ratio | times: 100 | default: 100 }}%;
    background-size: cover;
    background-position: center 20%;
  }
</style>

{%- if image != blank -%}
  <div class="image-{{ responsive_image_counter }} lazyload responsive-bg-image" data-bgset="
    {%- if image.width > 180 -%}{{ image | img_url: '180x' }} 180w {{ 180 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 360 -%}{{ image | img_url: '360x' }} 360w {{ 360 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 540 -%}{{ image | img_url: '540x' }} 540w {{ 540 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 720 -%}{{ image | img_url: '720x' }} 720w {{ 720 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 900 -%}{{ image | img_url: '900x' }} 900w {{ 900 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 1080 -%}{{ image | img_url: '1080x' }} 1080w {{ 1080 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 1296 -%}{{ image | img_url: '1296x' }} 1296w {{ 1296 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 1512 -%}{{ image | img_url: '1512x' }} 1512w {{ 1512 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 1728 -%}{{ image | img_url: '1728x' }} 1728w {{ 1728 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 1944 -%}{{ image | img_url: '1944x' }} 1944w {{ 1944 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 2160 -%}{{ image | img_url: '2160x' }} 2160w {{ 2160 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 2376 -%}{{ image | img_url: '2376x' }} 2376w {{ 2376 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 2592 -%}{{ image | img_url: '2592x' }} 2592w {{ 2592 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 2808 -%}{{ image | img_url: '2808x' }} 2808w {{ 2808 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- if image.width > 3024 -%}{{ image | img_url: '3024x' }} 3024w {{ 3024 | divided_by: image.aspect_ratio | round }}h,{%- endif -%}
    {%- assign image_size = image.width | append: 'x' -%}
    {{ image | img_url: image_size }} {{ image.width }}w {{ image.height }}h"
    style="background-image:url({{ image | img_url: '1150x' }})">
  </div>
{%- endif -%}
