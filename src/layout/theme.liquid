<!doctype html>
  <!-- ===========================================================================
  Feel free to add your own header, but please keep the following:
   ___  _   _    _
  /   || | | |  | |
  \__  | | | |  | |  __
  /    |/  |/_) |/  /  \_/\/
  \___/|__/| \_/|__/\__/  /\_/
                |\
                |/

  Concrete v2.1.0
  https://github.com/Elkfox/Concrete
  Copyright (c) 2018 Elkfox Co Pty Ltd
  https://elkfox.com
  MIT License
  ============================================================================ -->

  <!--[if IE 9]><html class="ie9 no-js" lang="{{ shop.locale }}"><![endif]-->
  <!--[if (gt IE 9)|!(IE)]><!--><html class="no-js" lang="{{ shop.locale }}"><!--<![endif]-->

  <head>
    <!-- META ================================================================ -->
    {% include 'meta-theme' %}
    {% include 'meta-social' %}
    {% include 'meta-favorites' %}

    <!-- Shopify ============================================================= -->
    {{ content_for_header }}

    <!-- CSS ================================================================= -->
    {{ 'app.scss.css' | asset_url | stylesheet_tag }}

    <!-- JavaScript =========================================================== -->
    {% if shop.customer_accounts_enabled and template contains 'customers' %}
      {{ 'shopify_common.js' | shopify_asset_url | script_tag }}
    {% endif %}

    {{ 'vendor.js' | asset_url | script_tag }}
    <!--[if (gt IE 9)|!(IE)]><!--><script src="{{ 'app.js' | asset_url }}" defer="defer"></script><!--<![endif]-->
    <!--[if lte IE 9]><script src="{{ 'app.js' | asset_url }}"></script><![endif]-->

    <script type="text/javascript">
      $(document).ready(function() {
        window.cartFox = new CartFox({
          cart: {{ cart | json }},
          options: {
            moneyFormat: {{ shop.money_with_currency_format | json }},
            logs: false,
          }
        });

        $(document).trigger('cartfox:loaded', cartFox.cart);
      });

      // Cart error handling
      $(document).on('cartfox:error', function(event, error) {
        const source = $('[data-cart-popup-error-template]').html();
        const template = Handlebars.compile(source);
        const html = template(error.responseJSON);
        $('[data-cart-popup-error-container]').html(html);
        $('body').removeClass('active-cart');
        PopupError.show();
      });

      // Cart active state
      $(document).on('cartfox:beforeRender', function(event) {
        $('body').addClass('active-cart');
      });

      // Cart popup rendering
      $(document).on('cartfox:loaded cartfox:onRender', function(event, cart) {
        const source = $('[data-cart-popup-template]').html();
        const template = Handlebars.compile(source);
        const html = template(cart);
        $('[data-cart-popup-container]').html(html);
        $('body').removeClass('active-cart');
      });

      // Cart item added
      $(document).on('cartfox:itemAddedToCart', function(event, cart) {
        PopupCart.show();
      });
    </script>
  </head>

  <body id="{{ page_title | handle }}" class="{% if customer %}customer-logged-in {% endif %}template-{{ template | replace: '.', ' ' | truncatewords: 1, '' | handle }}{% if template.suffix != null %} suffix-{{ template.suffix }}{% endif %}" itemscope itemtype="http://schema.org/WebSite">
    {% section 'theme-header' %}

    <main id="MainContent" role="main">
      {{ content_for_layout }}
    </main>

    {% section 'theme-footer' %}
    {% include 'popup-cart' %}
    {% include 'popup-error' %}

    {% if customer %}
      {% include 'popup-account' %}
    {% endif %}
  </body>

</html>
